<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>isFinite变量名冲突修复测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>isFinite变量名冲突修复测试</h1>
    
    <div>
        <button onclick="testIsFiniteFix()">测试修复</button>
        <div id="testResult"></div>
    </div>

    <script>
        // 模拟修复后的坐标验证函数
        function isValidCoordinates(position) {
            if (!position || typeof position.lng !== 'number' || typeof position.lat !== 'number') {
                return false
            }
            
            // 检查是否为NaN
            if (isNaN(position.lng) || isNaN(position.lat)) {
                return false
            }
            
            // 检查经纬度范围是否合理
            const isValidLng = position.lng >= -180 && position.lng <= 180
            const isValidLat = position.lat >= -90 && position.lat <= 90
            
            // 检查是否为0坐标（通常表示无效坐标）
            const isNotZero = position.lng !== 0 || position.lat !== 0
            
            // 检查是否为有限数字 - 修复后的变量名
            const isFiniteNumber = isFinite(position.lng) && isFinite(position.lat)
            
            return isValidLng && isValidLat && isNotZero && isFiniteNumber
        }

        function testIsFiniteFix() {
            const testCases = [
                { position: { lng: 116.397428, lat: 39.90923 }, expected: true, name: '有效坐标' },
                { position: { lng: NaN, lat: 39.90923 }, expected: false, name: 'NaN经度' },
                { position: { lng: 116.397428, lat: NaN }, expected: false, name: 'NaN纬度' },
                { position: { lng: Infinity, lat: 39.90923 }, expected: false, name: '无穷大经度' },
                { position: { lng: 116.397428, lat: -Infinity }, expected: false, name: '负无穷大纬度' },
                { position: { lng: 0, lat: 0 }, expected: false, name: '零坐标' },
                { position: { lng: 181, lat: 39.90923 }, expected: false, name: '超出经度范围' },
                { position: { lng: 116.397428, lat: 91 }, expected: false, name: '超出纬度范围' }
            ]

            let resultHtml = '<div class="test-title">测试结果:</div>'
            let allPassed = true

            testCases.forEach((testCase, index) => {
                try {
                    const result = isValidCoordinates(testCase.position)
                    const passed = result === testCase.expected
                    
                    if (passed) {
                        resultHtml += `<div class="test-result success">✅ 测试 ${index + 1}: ${testCase.name} - 通过</div>`
                    } else {
                        resultHtml += `<div class="test-result error">❌ 测试 ${index + 1}: ${testCase.name} - 失败 (期望: ${testCase.expected}, 实际: ${result})</div>`
                        allPassed = false
                    }
                } catch (error) {
                    resultHtml += `<div class="test-result error">❌ 测试 ${index + 1}: ${testCase.name} - 异常: ${error.message}</div>`
                    allPassed = false
                }
            })

            if (allPassed) {
                resultHtml += `<div class="test-result success">🎉 所有测试通过！isFinite变量名冲突已修复。</div>`
            } else {
                resultHtml += `<div class="test-result error">⚠️ 部分测试失败，需要进一步检查。</div>`
            }

            document.getElementById('testResult').innerHTML = resultHtml
        }

        // 页面加载时自动运行测试
        window.onload = function() {
            console.log('isFinite变量名冲突修复测试页面已加载')
            testIsFiniteFix()
        }
    </script>
</body>
</html> 