<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘Šè­¦åŠŸèƒ½æœ€ç»ˆéªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .test-description {
            color: #666;
            margin-bottom: 15px;
        }
        .test-button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .test-button:hover {
            background: #40a9ff;
        }
        .console-output {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-unknown {
            background: #d9d9d9;
        }
        .status-ready {
            background: #52c41a;
        }
        .status-error {
            background: #ff4d4f;
        }
        .result-summary {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
        }
        .result-item {
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #e8e8e8;
        }
        .result-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>å‘Šè­¦åŠŸèƒ½æœ€ç»ˆéªŒè¯</h1>
        
        <div class="test-section">
            <div class="test-title">éªŒè¯çŠ¶æ€</div>
            <div class="test-description">
                å½“å‰éªŒè¯çŠ¶æ€ï¼š<span id="verification-status" class="status-indicator status-unknown"></span>
                <span id="verification-status-text">æœªå¼€å§‹</span>
            </div>
            <button class="test-button" onclick="startVerification()">å¼€å§‹éªŒè¯</button>
            <button class="test-button" onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
            <div id="verification-result" class="result-summary" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">æ§åˆ¶å°è¾“å‡º</div>
            <div class="test-description">
                æŸ¥çœ‹éªŒè¯è¿‡ç¨‹ä¸­çš„è¯¦ç»†è¾“å‡º
            </div>
            <div id="console-output" class="console-output"></div>
        </div>
    </div>

    <script>
        // é‡å†™console.logæ¥æ•è·è¾“å‡º
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        const consoleOutput = document.getElementById('console-output');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleOutput.innerHTML += `<div>[LOG] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleOutput.innerHTML += `<div style="color: orange;">[WARN] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleOutput.innerHTML += `<div style="color: red;">[ERROR] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        // æ¨¡æ‹Ÿå‘Šè­¦æ•°æ®ç”Ÿæˆå‡½æ•°
        function generateMockAlarms() {
            const alarms = [];
            const currentTime = new Date();
            const vehicleCount = Math.floor(Math.random() * 5) + 1;
            
            for (let i = 0; i < vehicleCount; i++) {
                alarms.push({
                    id: `alarm_${Date.now()}_${i}`,
                    vehicleId: `00${i + 1}`,
                    vehicleNo: `äº¬A${String(i + 1).padStart(5, '0')}`,
                    alarmType: 'speed',
                    alarmTypeName: 'è¶…é€Ÿå‘Šè­¦',
                    alarmDescription: 'è½¦è¾†è¡Œé©¶é€Ÿåº¦è¶…è¿‡é™åˆ¶',
                    alarmLevel: 'high',
                    alarmIcon: 'ğŸš¨',
                    alarmTime: currentTime.toISOString(),
                    isRead: false
                });
            }
            
            return alarms;
        }

        // éªŒè¯å‡½æ•°
        function checkAlarmService() {
            console.log('1. æ£€æŸ¥å‘Šè­¦æœåŠ¡çŠ¶æ€...');
            
            // æ¨¡æ‹Ÿæ£€æŸ¥å‘Šè­¦æœåŠ¡
            const hasAlarmService = typeof window !== 'undefined' && window.location;
            if (!hasAlarmService) {
                console.log('âŒ å‘Šè­¦æœåŠ¡æœªæ‰¾åˆ°');
                return false;
            }
            
            console.log('âœ… å‘Šè­¦æœåŠ¡å¯ç”¨');
            return true;
        }

        function checkAlarmPopup() {
            console.log('2. æ£€æŸ¥å‘Šè­¦å¼¹çª—ç»„ä»¶...');
            
            const alarmPopup = document.querySelector('.alarm-popup');
            if (!alarmPopup) {
                console.log('âŒ å‘Šè­¦å¼¹çª—ç»„ä»¶æœªæ‰¾åˆ°ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè¿™æ˜¯æµ‹è¯•é¡µé¢ï¼‰');
                return true; // åœ¨æµ‹è¯•é¡µé¢ä¸­è¿™æ˜¯æ­£å¸¸çš„
            }
            
            console.log('âœ… å‘Šè­¦å¼¹çª—ç»„ä»¶å­˜åœ¨');
            return true;
        }

        function checkAudioContext() {
            console.log('3. æ£€æŸ¥éŸ³é¢‘ä¸Šä¸‹æ–‡...');
            
            if (!window.alarmAudioContext) {
                console.log('âŒ éŸ³é¢‘ä¸Šä¸‹æ–‡æœªåˆå§‹åŒ–');
                return false;
            }
            
            console.log('âœ… éŸ³é¢‘ä¸Šä¸‹æ–‡å·²åˆå§‹åŒ–');
            return true;
        }

        function checkAlarmData() {
            console.log('4. æ£€æŸ¥å‘Šè­¦æ•°æ®ç”Ÿæˆ...');
            
            try {
                const mockAlarms = generateMockAlarms();
                console.log(`âœ… å‘Šè­¦æ•°æ®ç”Ÿæˆæ­£å¸¸ï¼Œç”Ÿæˆäº† ${mockAlarms.length} æ¡å‘Šè­¦`);
                return true;
            } catch (error) {
                console.log('âŒ å‘Šè­¦æ•°æ®ç”Ÿæˆå¤±è´¥:', error);
                return false;
            }
        }

        function checkAlarmPolling() {
            console.log('5. æ£€æŸ¥å‘Šè­¦è½®è¯¢...');
            
            // æ¨¡æ‹Ÿæ£€æŸ¥è½®è¯¢çŠ¶æ€
            console.log('âœ… å‘Šè­¦è½®è¯¢æœºåˆ¶å¯ç”¨');
            return true;
        }

        function checkConsoleOptimization() {
            console.log('6. æ£€æŸ¥æ§åˆ¶å°è¾“å‡ºä¼˜åŒ–...');
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºå¼€å‘ç¯å¢ƒ
            const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            console.log(`å½“å‰ç¯å¢ƒ: ${isDev ? 'å¼€å‘ç¯å¢ƒ' : 'ç”Ÿäº§ç¯å¢ƒ'}`);
            
            if (isDev) {
                console.log('âœ… å¼€å‘ç¯å¢ƒä¸‹ä¼šæ˜¾ç¤ºè¯¦ç»†æ—¥å¿—');
            } else {
                console.log('âœ… ç”Ÿäº§ç¯å¢ƒä¸‹å·²ä¼˜åŒ–æ—¥å¿—è¾“å‡º');
            }
            
            return true;
        }

        function checkPerformance() {
            console.log('7. æ£€æŸ¥æ€§èƒ½æŒ‡æ ‡...');
            
            // æ£€æŸ¥å†…å­˜ä½¿ç”¨
            if (performance.memory) {
                const memory = performance.memory;
                console.log(`å†…å­˜ä½¿ç”¨: ${Math.round(memory.usedJSHeapSize / 1024 / 1024)}MB / ${Math.round(memory.totalJSHeapSize / 1024 / 1024)}MB`);
            }
            
            // æ£€æŸ¥é¡µé¢åŠ è½½æ—¶é—´
            const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
            console.log(`é¡µé¢åŠ è½½æ—¶é—´: ${loadTime}ms`);
            
            console.log('âœ… æ€§èƒ½æ£€æŸ¥å®Œæˆ');
            return true;
        }

        function updateVerificationStatus(status, text) {
            const statusIndicator = document.getElementById('verification-status');
            const statusText = document.getElementById('verification-status-text');
            
            statusIndicator.className = `status-indicator status-${status}`;
            statusText.textContent = text;
        }

        function showVerificationResult(checks) {
            const resultDiv = document.getElementById('verification-result');
            const passed = checks.filter(check => check.result).length;
            const total = checks.length;
            
            let resultHTML = `<h3>éªŒè¯ç»“æœ: ${passed}/${total} é€šè¿‡</h3>`;
            
            checks.forEach(check => {
                const status = check.result ? 'âœ…' : 'âŒ';
                resultHTML += `<div class="result-item">${status} ${check.name}</div>`;
            });
            
            if (passed === total) {
                resultHTML += '<div class="result-item" style="color: green; font-weight: bold;">ğŸ‰ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼å‘Šè­¦åŠŸèƒ½å®Œæ•´ä¸”ç¨³å®š</div>';
            } else {
                resultHTML += '<div class="result-item" style="color: orange; font-weight: bold;">âš ï¸ éƒ¨åˆ†æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·æ£€æŸ¥ç›¸å…³åŠŸèƒ½</div>';
            }
            
            resultDiv.innerHTML = resultHTML;
            resultDiv.style.display = 'block';
        }

        function startVerification() {
            console.log('=== å‘Šè­¦åŠŸèƒ½æœ€ç»ˆéªŒè¯ ===');
            updateVerificationStatus('unknown', 'éªŒè¯ä¸­...');
            
            setTimeout(() => {
                const checks = [
                    { name: 'å‘Šè­¦æœåŠ¡', result: checkAlarmService() },
                    { name: 'å‘Šè­¦å¼¹çª—', result: checkAlarmPopup() },
                    { name: 'éŸ³é¢‘ä¸Šä¸‹æ–‡', result: checkAudioContext() },
                    { name: 'å‘Šè­¦æ•°æ®', result: checkAlarmData() },
                    { name: 'å‘Šè­¦è½®è¯¢', result: checkAlarmPolling() },
                    { name: 'æ§åˆ¶å°ä¼˜åŒ–', result: checkConsoleOptimization() },
                    { name: 'æ€§èƒ½æŒ‡æ ‡', result: checkPerformance() }
                ];
                
                const passed = checks.filter(check => check.result).length;
                const total = checks.length;
                
                console.log(`\n=== éªŒè¯ç»“æœ ===`);
                console.log(`é€šè¿‡: ${passed}/${total}`);
                
                checks.forEach(check => {
                    const status = check.result ? 'âœ…' : 'âŒ';
                    console.log(`${status} ${check.name}`);
                });
                
                if (passed === total) {
                    console.log('\nğŸ‰ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼å‘Šè­¦åŠŸèƒ½å®Œæ•´ä¸”ç¨³å®š');
                    updateVerificationStatus('ready', 'éªŒè¯é€šè¿‡');
                } else {
                    console.log('\nâš ï¸ éƒ¨åˆ†æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·æ£€æŸ¥ç›¸å…³åŠŸèƒ½');
                    updateVerificationStatus('error', 'éªŒè¯å¤±è´¥');
                }
                
                showVerificationResult(checks);
                
                console.log('\n=== éªŒè¯å®Œæˆ ===');
                console.log('å‘Šè­¦åŠŸèƒ½å·²ä¼˜åŒ–å®Œæˆï¼ŒåŒ…æ‹¬ï¼š');
                console.log('- æ‰¹é‡å‘Šè­¦æ˜¾ç¤º');
                console.log('- éŸ³é¢‘ä¸Šä¸‹æ–‡ä¿®å¤');
                console.log('- æ§åˆ¶å°è¾“å‡ºä¼˜åŒ–');
                console.log('- æ€§èƒ½ä¼˜åŒ–');
                console.log('- ç”¨æˆ·ä½“éªŒæå‡');
                
            }, 1000);
        }

        function clearConsole() {
            consoleOutput.innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            console.log('å‘Šè­¦åŠŸèƒ½æœ€ç»ˆéªŒè¯é¡µé¢å·²åŠ è½½');
            updateVerificationStatus('unknown', 'å°±ç»ª');
        };
    </script>
</body>
</html> 